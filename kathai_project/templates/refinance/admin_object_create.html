{% extends "base.html" %}
{% load refinance_tags %}
{% block title %}{{ form_title }} {{ model_name }}{% endblock %}

{% block content %}

<!-- Header -->
<div class="card card-ghost mb-4">
  <div class="d-flex flex-column align-items-center justify-content-center text-center py-4">
    <h2 class="title mb-1">
        {{ form_title }}
        {% if object.id %}(ID: {{ object.id }}){% endif %}
    </h2>
    <p class="subtitle">กรอกหรือแก้ไขข้อมูลของ {{ model_name }}</p>
  </div>

  <div class="card-body p-3 p-md-4">
    <form method="post" enctype="multipart/form-data" class="row g-3 g-md-4">
      {% csrf_token %}
      {% for field in fields %}
      <div class="col-12 col-md-6 px-5">
        <div class="mb-3">
          <label class="form-label">{{ field.name|capfirst }}</label>

          {% if field.choices %}
          <select name="{{ field.name }}" class="form-select">
            <option value="">-- เลือก --</option>
            {% for val, label in field.choices %}
              <option value="{{ val }}" {% if object|get_attr:field.name == val %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>

          {% elif field.is_relation and field.related_objects %}
          <select name="{{ field.name }}" class="form-select">
            <option value="">-- เลือก --</option>
            {% for rel in field.related_objects %}
              <option value="{{ rel.id }}"
                {% if object|get_attr:field.name and object|get_attr:field.name.id == rel.id %}selected{% endif %}>
                {{ rel }}
              </option>
            {% endfor %}
          </select>

          {% elif field.type == "DateField" %}
          <input type="date" name="{{ field.name }}" value="{{ object|get_attr:field.name }}" class="form-control">

          {% elif field.type == "DateTimeField" %}
          <input type="datetime-local" name="{{ field.name }}" 
                 value="{{ object|get_attr:field.name|date:'Y-m-d\\TH:i' }}" 
                 class="form-control">

          {% elif field.type == "IntegerField" or field.type == "FloatField" %}
          <input type="number" step="0.01" name="{{ field.name }}" value="{{ object|get_attr:field.name }}" class="form-control">

          {% elif field.type == "ImageField" or field.type == "FileField" %}
          <input type="file" name="{{ field.name }}" class="form-control">
          {% if object|get_attr:field.name %}
            <img src="{{ object|get_attr:field.name.url }}" 
                 alt="{{ field.name }}" 
                 class="mt-2 rounded border" 
                 style="max-width:200px;">
          {% endif %}

          {% else %}
          <input type="text" name="{{ field.name }}" value="{{ object|get_attr:field.name }}" class="form-control">

          {% endif %}
        </div>
      </div>
      {% endfor %}

      <div class="col-12 text-center mt-4">
        <button type="submit" class="btn btn-warning px-4 w-auto" style="min-width: 140px; min-height: 50px; border-radius: 10px;">
          <i class="bi bi-save me-1"></i> บันทึก
        </button>
        <a href="{% url 'refinance:admin_manage_table' model_name=model_name_for_form %}" 
           class="btn btn-outline-secondary ms-2 px-4 w-auto" style="min-width: 140px; min-height: 50px; border-radius: 10px;">
          <i class="bi bi-arrow-left me-1"></i> ย้อนกลับ
        </a>
      </div>
    </form>
  </div>
</div>

{% endblock %}
